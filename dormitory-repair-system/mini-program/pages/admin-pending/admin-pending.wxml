<view class="container">
  <!-- Loading State -->
  <view class="loading-state" wx:if="{{loading}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- Empty State -->
  <view class="empty-state" wx:if="{{!loading && orders.length === 0}}">
    <view class="empty-icon">ğŸ“‹</view>
    <text class="empty-text">æš‚æ— å¾…å¤„ç†è®¢å•</text>
    <text class="empty-subtext">ä¸‹æ‹‰åˆ·æ–°æŸ¥çœ‹æ–°è®¢å•</text>
  </view>

  <!-- Order List -->
  <view class="order-list" wx:if="{{!loading && orders.length > 0}}">
    <view 
      class="order-card {{item.status}}" 
      wx:for="{{orders}}" 
      wx:key="orderId"
      bindtap="showOrderDetail"
      data-order="{{item}}"
    >
      <view class="card-header">
        <view class="repair-type">
          <text class="type-icon">{{repairTypeMap[item.repairType] || 'ğŸ”§'}}</text>
          <text class="type-text">{{item.repairType}}</text>
        </view>
        <view class="status-badge {{item.status}}">
          {{item.status === 'pending' ? 'å¾…å¤„ç†' : 'å¤„ç†ä¸­'}}
        </view>
      </view>

      <view class="card-body">
        <view class="info-row">
          <text class="info-label">ğŸ“ ä½ç½®</text>
          <text class="info-value">{{item.building}} {{item.roomNumber}}</text>
        </view>
        
        <view class="info-row">
          <text class="info-label">ğŸ“ è”ç³»ç”µè¯</text>
          <text class="info-value">{{item.contactPhone}}</text>
        </view>
        
        <view class="info-row">
          <text class="info-label">ğŸ“ é—®é¢˜æè¿°</text>
          <text class="info-value description">{{item.description}}</text>
        </view>
      </view>

      <view class="card-footer">
        <text class="order-time">{{item.createdAt}}</text>
        <view class="action-btns">
          <button 
            class="btn btn-primary" 
            wx:if="{{item.status === 'pending'}}"
            catchtap="acceptOrder"
            data-order-id="{{item.orderId}}"
          >
            æ¥å•
          </button>
          <button 
            class="btn btn-success" 
            wx:if="{{item.status === 'processing'}}"
            catchtap="showCompleteModal"
            data-order="{{item}}"
          >
            å®ŒæˆæŠ¥ä¿®
          </button>
        </view>
      </view>
    </view>
  </view>

  <!-- Order Detail Modal -->
  <view class="modal {{showModal ? 'show' : ''}}" wx:if="{{showModal}}">
    <view class="modal-overlay" bindtap="closeModal"></view>
    <view class="modal-content" catchtap="preventBubble">
      <view class="modal-header">
        <text class="modal-title">è®¢å•è¯¦æƒ…</text>
        <view class="close-btn" bindtap="closeModal">âœ•</view>
      </view>

      <scroll-view class="modal-body" scroll-y>
        <view class="detail-section" wx:if="{{currentOrder}}">
          <view class="detail-row">
            <text class="detail-label">æŠ¥ä¿®ç±»å‹</text>
            <view class="detail-value">
              <text>{{repairTypeMap[currentOrder.repairType] || 'ğŸ”§'}}</text>
              <text>{{currentOrder.repairType}}</text>
            </view>
          </view>

          <view class="detail-row">
            <text class="detail-label">è®¢å•çŠ¶æ€</text>
            <view class="status-badge {{currentOrder.status}}">
              {{currentOrder.status === 'pending' ? 'å¾…å¤„ç†' : 'å¤„ç†ä¸­'}}
            </view>
          </view>

          <view class="detail-row">
            <text class="detail-label">æ¥¼æ ‹æˆ¿é—´</text>
            <text class="detail-value">{{currentOrder.building}} {{currentOrder.roomNumber}}</text>
          </view>

          <view class="detail-row">
            <text class="detail-label">è”ç³»ç”µè¯</text>
            <text class="detail-value">{{currentOrder.contactPhone}}</text>
          </view>

          <view class="detail-row">
            <text class="detail-label">é—®é¢˜æè¿°</text>
            <text class="detail-value description">{{currentOrder.description}}</text>
          </view>

          <view class="detail-row" wx:if="{{currentOrder.images && currentOrder.images.length > 0}}">
            <text class="detail-label">æŠ¥ä¿®å›¾ç‰‡</text>
            <view class="image-list">
              <image 
                wx:for="{{currentOrder.images}}" 
                wx:key="imageId"
                class="detail-image" 
                src="{{item.imageUrl}}" 
                mode="aspectFill"
                bindtap="previewImage"
                data-url="{{item.imageUrl}}"
                data-urls="{{currentOrder.images.map(img => img.imageUrl)}}"
              />
            </view>
          </view>

          <view class="detail-row">
            <text class="detail-label">æäº¤æ—¶é—´</text>
            <text class="detail-value">{{currentOrder.createdAt}}</text>
          </view>
        </view>
      </scroll-view>

      <view class="modal-footer">
        <button 
          class="btn btn-primary btn-full" 
          wx:if="{{currentOrder.status === 'pending'}}"
          bindtap="acceptOrder"
          data-order-id="{{currentOrder.orderId}}"
        >
          æ¥å•å¤„ç†
        </button>
        <button 
          class="btn btn-success btn-full" 
          wx:if="{{currentOrder.status === 'processing'}}"
          bindtap="showCompleteModal"
          data-order="{{currentOrder}}"
        >
          å®ŒæˆæŠ¥ä¿®
        </button>
      </view>
    </view>
  </view>

  <!-- Complete Order Modal -->
  <view class="modal {{showCompleteModal ? 'show' : ''}}" wx:if="{{showCompleteModal}}">
    <view class="modal-overlay" bindtap="closeCompleteModal"></view>
    <view class="modal-content" catchtap="preventBubble">
      <view class="modal-header">
        <text class="modal-title">å®ŒæˆæŠ¥ä¿®</text>
        <view class="close-btn" bindtap="closeCompleteModal">âœ•</view>
      </view>

      <view class="modal-body">
        <view class="upload-section">
          <text class="upload-label">ä¸Šä¼ å®Œæˆå‡­è¯</text>
          <text class="upload-hint">è¯·ä¸Šä¼ ç»´ä¿®å®Œæˆåçš„ç…§ç‰‡ï¼ˆæœ€å¤š3å¼ ï¼‰</text>
          
          <view class="upload-list">
            <view 
              class="upload-item image-preview" 
              wx:for="{{completionImages}}" 
              wx:key="*this"
            >
              <image class="preview-img" src="{{item}}" mode="aspectFill" bindtap="previewCompletionImage" data-url="{{item}}" />
              <view class="remove-btn" catchtap="removeCompletionImage" data-index="{{index}}">âœ•</view>
            </view>
            
            <view class="upload-item upload-btn" wx:if="{{completionImages.length < 3}}" bindtap="chooseCompletionImages">
              <text class="upload-icon">+</text>
              <text class="upload-text">ä¸Šä¼ å›¾ç‰‡</text>
            </view>
          </view>

          <view class="upload-loading" wx:if="{{uploadLoading}}">
            <view class="spinner"></view>
            <text>ä¸Šä¼ ä¸­...</text>
          </view>
        </view>
      </view>

      <view class="modal-footer">
        <button 
          class="btn btn-success btn-full {{submitting ? 'loading' : ''}}" 
          disabled="{{submitting}}"
          bindtap="submitCompleteOrder"
        >
          {{submitting ? 'æäº¤ä¸­...' : 'ç¡®è®¤å®Œæˆ'}}
        </button>
      </view>
    </view>
  </view>
</view>
