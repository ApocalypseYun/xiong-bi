<view class="container">
  <!-- Date Filter Section -->
  <view class="filter-section">
    <view class="filter-header">
      <text class="filter-title">ğŸ“… æ—¥æœŸç­›é€‰</text>
      <text class="filter-reset" bindtap="resetDateFilter">é‡ç½®</text>
    </view>
    
    <view class="date-picker-row">
      <view class="date-picker">
        <text class="picker-label">å¼€å§‹æ—¥æœŸ</text>
        <picker mode="date" value="{{startDate}}" bindchange="onStartDateChange">
          <view class="picker-value">{{startDate}}</view>
        </picker>
      </view>
      
      <text class="date-separator">è‡³</text>
      
      <view class="date-picker">
        <text class="picker-label">ç»“æŸæ—¥æœŸ</text>
        <picker mode="date" value="{{endDate}}" bindchange="onEndDateChange">
          <view class="picker-value">{{endDate}}</view>
        </picker>
      </view>
    </view>
    
    <button class="search-btn" bindtap="searchOrders">ğŸ” æŸ¥è¯¢è®¢å•</button>
  </view>

  <!-- Loading State -->
  <view class="loading-state" wx:if="{{loading}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- Empty State -->
  <view class="empty-state" wx:if="{{!loading && orders.length === 0}}">
    <view class="empty-icon">âœ…</view>
    <text class="empty-text">æš‚æ— å·²å®Œæˆè®¢å•</text>
    <text class="empty-subtext">è¯•è¯•è°ƒæ•´æ—¥æœŸèŒƒå›´</text>
  </view>

  <!-- Order List -->
  <view class="order-list" wx:if="{{!loading && orders.length > 0}}">
    <view class="list-header">
      <text class="order-count">å…± {{orders.length}} æ¡è®°å½•</text>
    </view>

    <view 
      class="order-card completed" 
      wx:for="{{orders}}" 
      wx:key="orderId"
      bindtap="showOrderDetail"
      data-order="{{item}}"
    >
      <view class="card-header">
        <view class="repair-type">
          <text class="type-icon">{{repairTypeMap[item.repairType] || 'ğŸ”§'}}</text>
          <text class="type-text">{{item.repairType}}</text>
        </view>
        <view class="status-badge completed">
          å·²å®Œæˆ
        </view>
      </view>

      <view class="card-body">
        <view class="info-row">
          <text class="info-label">ğŸ“ ä½ç½®</text>
          <text class="info-value">{{item.building}} {{item.roomNumber}}</text>
        </view>
        
        <view class="info-row">
          <text class="info-label">ğŸ“ è”ç³»ç”µè¯</text>
          <text class="info-value">{{item.contactPhone}}</text>
        </view>
        
        <view class="info-row">
          <text class="info-label">ğŸ“ é—®é¢˜æè¿°</text>
          <text class="info-value description">{{item.description}}</text>
        </view>
      </view>

      <view class="card-footer">
        <view class="time-info">
          <text class="time-label">å®Œæˆæ—¶é—´</text>
          <text class="time-value">{{item.completedAt}}</text>
        </view>
        
        <view class="evaluation-badge" wx:if="{{item.evaluation}}">
          <text class="stars">{{'â˜…'.repeat(item.evaluation.rating)}}{{item.evaluation.rating < 5 ? 'â˜†'.repeat(5 - item.evaluation.rating) : ''}}</text>
          <text class="has-eval">å·²è¯„ä»·</text>
        </view>
        
        <view class="evaluation-badge no-eval" wx:if="{{!item.evaluation}}">
          <text>æœªè¯„ä»·</text>
        </view>
      </view>
    </view>
  </view>

  <!-- Order Detail Modal -->
  <view class="modal {{showModal ? 'show' : ''}}" wx:if="{{showModal}}">
    <view class="modal-overlay" bindtap="closeModal"></view>
    <view class="modal-content" catchtap="preventBubble">
      <view class="modal-header">
        <text class="modal-title">è®¢å•è¯¦æƒ…</text>
        <view class="close-btn" bindtap="closeModal">âœ•</view>
      </view>

      <scroll-view class="modal-body" scroll-y>
        <view class="detail-section" wx:if="{{currentOrder}}">
          <!-- Status Badge -->
          <view class="detail-status-row">
            <view class="status-badge large completed">å·²å®Œæˆ</view>
          </view>

          <view class="detail-row">
            <text class="detail-label">æŠ¥ä¿®ç±»å‹</text>
            <view class="detail-value">
              <text>{{repairTypeMap[currentOrder.repairType] || 'ğŸ”§'}}</text>
              <text>{{currentOrder.repairType}}</text>
            </view>
          </view>

          <view class="detail-row">
            <text class="detail-label">æ¥¼æ ‹æˆ¿é—´</text>
            <text class="detail-value">{{currentOrder.building}} {{currentOrder.roomNumber}}</text>
          </view>

          <view class="detail-row">
            <text class="detail-label">è”ç³»ç”µè¯</text>
            <text class="detail-value">{{currentOrder.contactPhone}}</text>
          </view>

          <view class="detail-row">
            <text class="detail-label">é—®é¢˜æè¿°</text>
            <text class="detail-value description">{{currentOrder.description}}</text>
          </view>

          <!-- Original Images -->
          <view class="detail-row" wx:if="{{currentOrder.images && currentOrder.images.length > 0}}">
            <text class="detail-label">æŠ¥ä¿®å›¾ç‰‡</text>
            <view class="image-list">
              <image 
                wx:for="{{currentOrder.images}}" 
                wx:key="imageId"
                class="detail-image" 
                src="{{item.imageUrl}}" 
                mode="aspectFill"
                bindtap="previewImage"
                data-url="{{item.imageUrl}}"
                data-urls="{{currentOrder.images.map(img => img.imageUrl)}}"
              />
            </view>
          </view>

          <!-- Completion Images -->
          <view class="detail-row" wx:if="{{currentOrder.completionImages && currentOrder.completionImages.length > 0}}">
            <text class="detail-label">å®Œæˆå‡­è¯</text>
            <view class="image-list">
              <image 
                wx:for="{{currentOrder.completionImages}}" 
                wx:key="imageId"
                class="detail-image" 
                src="{{item.imageUrl}}" 
                mode="aspectFill"
                bindtap="previewImage"
                data-url="{{item.imageUrl}}"
                data-urls="{{currentOrder.completionImages.map(img => img.imageUrl)}}"
              />
            </view>
          </view>

          <view class="detail-row">
            <text class="detail-label">æäº¤æ—¶é—´</text>
            <text class="detail-value">{{currentOrder.createdAt}}</text>
          </view>

          <view class="detail-row">
            <text class="detail-label">å®Œæˆæ—¶é—´</text>
            <text class="detail-value">{{currentOrder.completedAt}}</text>
          </view>

          <!-- Evaluation Section -->
          <view class="evaluation-section" wx:if="{{currentOrder.evaluation}}">
            <view class="section-title">ğŸ“ ç”¨æˆ·è¯„ä»·</view>
            
            <view class="evaluation-content">
              <view class="rating-row">
                <text class="rating-label">è¯„åˆ†</text>
                <view class="rating-stars">
                  <text class="star filled" wx:for="{{[1,2,3,4,5]}}" wx:key="*this" wx:if="{{item <= currentOrder.evaluation.rating}}">â˜…</text>
                  <text class="star" wx:for="{{[1,2,3,4,5]}}" wx:key="*this" wx:if="{{item > currentOrder.evaluation.rating}}">â˜…</text>
                </view>
                <text class="rating-text">{{evaluationLabels[currentOrder.evaluation.rating - 1]}}</text>
              </view>
              
              <view class="comment-row" wx:if="{{currentOrder.evaluation.comment}}">
                <text class="comment-label">è¯„ä»·å†…å®¹</text>
                <text class="comment-text">{{currentOrder.evaluation.comment}}</text>
              </view>
              
              <view class="eval-time">
                <text>è¯„ä»·æ—¶é—´ï¼š{{currentOrder.evaluation.createdAt}}</text>
              </view>
            </view>
          </view>

          <view class="no-evaluation" wx:if="{{!currentOrder.evaluation}}">
            <text>è¯¥è®¢å•å°šæœªæ”¶åˆ°ç”¨æˆ·è¯„ä»·</text>
          </view>
        </view>
      </scroll-view>
    </view>
  </view>
</view>
